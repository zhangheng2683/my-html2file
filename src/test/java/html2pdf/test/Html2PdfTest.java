package html2pdf.test;

import my.html2file.html2pdf.service.Html2PdfService;
import org.junit.Test;

import java.io.File;
import java.io.FileOutputStream;
import java.io.OutputStream;
import java.util.UUID;

/**
 * html转PDF测试
 *
 * @author 欧阳洁
 * @since 2018-03-28 15:35
 */
public class Html2PdfTest {

    // 临时目录的路径
    public static final String TEMP_DIR_PATH = Html2PdfTest.class.getResource("/").getPath().substring(1) + "temp/";

    static {
        // 生成临时目录
        new File(TEMP_DIR_PATH).mkdirs();
    }

    @Test
    public void html2pdf() throws Exception {
        String htmlContent = "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"><html  xmlns=\"http://www.w3.org/1999/xhtml\" ><head><meta http-equiv=\"Content-Type\" content=\"text/html;charset=UTF-8\" /></head><body><div id=\"wr-content-panel\" style=\"width: 400px; height: 365px; padding: 95px 120px; overflow: hidden auto; font-family: &quot;微软雅黑&quot;; font-size: 16px; background-color: rgb(255, 255, 255); text-align: left; margin: 0px;\"><p style=\"text-align:center;\"><span style=\"line-height:46px;color:rgb(34, 34, 34);background-color:rgba(0, 0, 0, 0);font-family:微软雅黑, \" microsoft=\"\"><font size=\"5\">绍兴财政收入</font>2015&nbsp;{@地区}&nbsp;</span></p><p></p><p style=\"text-align:start;\"><span style=\"line-height:18.5714px;color:rgb(34, 34, 34);background-color:rgba(0, 0, 0, 0);font-family:\" helvetica=\"\">2012年3月</span></p><p style=\"text-align:start;\"><span style=\"line-height:18.5714px;color:rgb(34, 34, 34);background-color:rgba(0, 0, 0, 0);font-family:\" helvetica=\"\">去玩儿群<font style=\"background-color: rgb(255, 0, 0);\" size=\"5\">翁二</font></span></p><p style=\"text-align:start;\"><span style=\"line-height:45px;color:rgb(34, 34, 34);background-color:rgba(0, 0, 0, 0);font-family:宋体, SimSun;font-size:30px;\">行间距测试</span></p><p style=\"text-align:start;\"><span style=\"line-height:18.5714px;color:rgb(34, 34, 34);background-color:rgba(0, 0, 0, 0);font-family:\" helvetica=\"\">2015&nbsp;年&nbsp;10600017&nbsp;财政总收入&nbsp;17681516.16&nbsp;亿。<br/><br/>1、选择输入SQL语句还是选择使用存储过程。如果使用SQL，则录入SQL文本；如果使用存储过程，则表示选择系统默认设定的面向计算值计算的存储过程；<br/>2、点右上方的“刷新”按钮，把SQL语句或存储过程返回的字段结构列出在右边的列表中，可以修改列表中的“别名”的内容；<br/>3、保存，计算值设计完成。<br/><br/>可以这么认为：采用SQL的计算值是【实时计算值】；而采用存储过程的计算值是【预加工计算值】。SQL语句一般都比较简单，对于参数的轮询能力很有限，所以适合处理“实时计算值”，“实时计算值”的参数不需要轮询。&nbsp;<br/><br/>另外，右键<a href=\"javascript:void(0)\" class=\"we-link\" onclick=\"WR.linkClick.clickLinkedChart('pctmblk07');return false;\" _href=\"javascript:void(0)\">图2</a>中&nbsp;“CZSR”节点，执行菜单项“执行…”。如果该计算值属于“实时计算值”，则先要求用户输入参数，执行后显示返回的执行结果；如果是“预加工计算值”，则可以调用计算引擎对“CZSR”计算值进行计算并保存计算结果。<br/></span></p><p></p><p style=\"text-align:start;\"><span style=\"line-height:18.5714px;color:rgb(34, 34, 34);background-color:rgba(0, 0, 0, 0);font-family:\" helvetica=\"\">1234567<font color=\"#ff9c00\">89</font></span></p><div class=\"chartLine\" style=\"width:100%;height:500px;\"><img class=\"i9ltjx2k8 hide\" style=\"width: 267px; height: 500px;\" src=\"http://localhost:8080/HappyServer/viewCacheImage?cacheId=1\"/><div class=\"chart\" id=\"i9ltjx2k8\" data-name=\"htwc_2018_07_24180749581\" style=\"float: left; line-height: 18.5714px; height: 500px; color: rgb(34, 34, 34); width: 50%; text-align: start; position: relative; background: transparent none repeat scroll 0% 0%; -moz-user-select: none; display: none;\" helvetica=\"\" data-option=\"{&quot;success&quot;:true,&quot;option&quot;:{&quot;title&quot;:{&quot;textStyle&quot;:{&quot;align&quot;:&quot;center&quot;,&quot;vertialAlign&quot;:&quot;middle&quot;,&quot;fontSize&quot;:20,&quot;fontFamily&quot;:&quot;sans-serif&quot;,&quot;fontStyle&quot;:&quot;normal&quot;,&quot;fontWeight&quot;:&quot;normal&quot;},&quot;subtextStyle&quot;:{&quot;fontSize&quot;:12},&quot;show&quot;:true,&quot;left&quot;:&quot;left&quot;,&quot;top&quot;:&quot;top&quot;},&quot;toolbox&quot;:{&quot;feature&quot;:{&quot;magicType&quot;:{&quot;show&quot;:true,&quot;type&quot;:[&quot;line&quot;,&quot;bar&quot;,&quot;stack&quot;,&quot;tiled&quot;]},&quot;dataView&quot;:{&quot;show&quot;:true},&quot;restore&quot;:{&quot;show&quot;:true},&quot;saveAsImage&quot;:{&quot;show&quot;:true}},&quot;show&quot;:true,&quot;right&quot;:20},&quot;tooltip&quot;:{&quot;formatter&quot;:&quot;function (params) { var res = '';if (params.componentType &amp;&amp; params.componentType=='timeline'){return params.name;}if(params.length > 0){  var axis;if(params[0].axisType.indexOf('time') >= 0){if(params[0].axisDim == 'x'){axis = chartObject.getOption().xAxis[params[0].axisIndex];}else{axis = chartObject.getOption().yAxis[params[0].axisIndex];}}  if(axis &amp;&amp; axis.axisLabel &amp;&amp; axis.axisLabel.timePartten){res += new Date(params[0].name).format(axis.axisLabel.timePartten)+ '<br/>';}else{res += params[0].name + '<br/>';}for(var i = 0, l = params.length; i < l; i++){var param = params[i];if( param.value &amp;&amp; param.value.length){if(typeof param.value[0] == 'number'){res += param.seriesName+' : '+commafy(Number(param.value[0]).toFixed(2));}else if(typeof param.value[1] == 'number'){res += param.seriesName+' : '+commafy(Number(param.value[1]).toFixed(2));}else{res += param.seriesName+' : ';}}else{if(param.value){res += param.seriesName+' : '+param.value;}else{res += param.seriesName+' : ';}}if(param.percent != null){ res += '('+param.percent+'%)'; } res += '<br/>';} }else{if(params.seriesName){res += params.seriesName+'<br/>';}if(params.data.value.length > 0){if(typeof params.data.value[0] == 'number'){res += params.data.name+' : '+commafy(Number(params.data.value[0]).toFixed(2));}else if(typeof params.data.value[1] == 'number'){res += params.data.name+' : '+commafy(Number(params.data.value[1]).toFixed(2));}else{res += params.data.name+' : ';}}else{res += params.data.name+' : '+commafy(Number(params.data.value).toFixed(2));}} return res;  } &quot;,&quot;trigger&quot;:&quot;axis&quot;,&quot;show&quot;:true},&quot;legend&quot;:{&quot;data&quot;:[{&quot;name&quot;:&quot;急速快递&quot;}],&quot;orient&quot;:&quot;horizontal&quot;,&quot;show&quot;:false,&quot;left&quot;:&quot;center&quot;,&quot;top&quot;:&quot;bottom&quot;},&quot;xAxis&quot;:[{&quot;show&quot;:true,&quot;type&quot;:&quot;category&quot;,&quot;position&quot;:&quot;bottom&quot;,&quot;data&quot;:[{&quot;value&quot;:&quot;1&quot;},{&quot;value&quot;:&quot;2&quot;},{&quot;value&quot;:&quot;3&quot;},{&quot;value&quot;:&quot;4&quot;},{&quot;value&quot;:&quot;5&quot;},{&quot;value&quot;:&quot;6&quot;},{&quot;value&quot;:&quot;7&quot;},{&quot;value&quot;:&quot;8&quot;},{&quot;value&quot;:&quot;9&quot;}]}],&quot;yAxis&quot;:[{&quot;show&quot;:true,&quot;type&quot;:&quot;value&quot;,&quot;position&quot;:&quot;left&quot;}],&quot;series&quot;:[{&quot;name&quot;:&quot;急速快递&quot;,&quot;type&quot;:&quot;line&quot;,&quot;xAxisIndex&quot;:0,&quot;yAxisIndex&quot;:0,&quot;data&quot;:[{&quot;name&quot;:&quot;1&quot;,&quot;value&quot;:[&quot;1&quot;,900.45]},{&quot;name&quot;:&quot;2&quot;,&quot;value&quot;:[&quot;2&quot;,916.48]},{&quot;name&quot;:&quot;3&quot;,&quot;value&quot;:[&quot;3&quot;,378.88]},{&quot;name&quot;:&quot;4&quot;,&quot;value&quot;:[&quot;4&quot;,1225.45]},{&quot;name&quot;:&quot;5&quot;,&quot;value&quot;:[&quot;5&quot;,442.02]},{&quot;name&quot;:&quot;6&quot;,&quot;value&quot;:[&quot;6&quot;,586.96]},{&quot;name&quot;:&quot;7&quot;,&quot;value&quot;:[&quot;7&quot;,393.87]},{&quot;name&quot;:&quot;8&quot;,&quot;value&quot;:[&quot;8&quot;,625.87]},{&quot;name&quot;:&quot;9&quot;,&quot;value&quot;:[&quot;9&quot;,381.86]}]}],&quot;catalog&quot;:0,&quot;grid&quot;:{},&quot;drillLevel&quot;:0},&quot;cacheId&quot;:&quot;3&quot;,&quot;chartId&quot;:&quot;5bfe083a-082a-4e0d-ae0d-10e911b7ca91&quot;,&quot;tdId&quot;:&quot;S_1_D_A1&quot;,&quot;chartSQL&quot;:&quot;&quot;,&quot;msg&quot;:&quot;&quot;,&quot;chartCellName&quot;:&quot;[null!A1]图表&quot;,&quot;dataSourceType&quot;:1}\" _echarts_instance_=\"ec_1532762707653\"><div style=\"position: relative; overflow: hidden; width: 267px; height: 500px; padding: 0px; margin: 0px; border-width: 0px;\"><canvas style=\"position: absolute; left: 0px; top: 0px; width: 267px; height: 500px; -moz-user-select: none; padding: 0px; margin: 0px; border-width: 0px;\" width=\"267\" height=\"500\" data-zr-dom-id=\"zr_0\"></canvas></div><div></div></div><img class=\"pctozj7zs hide\" style=\"width: 267px; height: 500px;\" src=\"http://localhost:8080/HappyServer/viewCacheImage?cacheId=2\"/><div class=\"chart\" id=\"pctozj7zs\" data-name=\"htwc_2018_07_26111246567\" style=\"float: left; line-height: 18.5714px; height: 500px; color: rgb(34, 34, 34); width: 50%; text-align: start; position: relative; background: transparent none repeat scroll 0% 0%; -moz-user-select: none; display: none;\" helvetica=\"\" data-option=\"{&quot;success&quot;:true,&quot;option&quot;:{&quot;title&quot;:{&quot;text&quot;:&quot;柱状图&quot;,&quot;textStyle&quot;:{&quot;align&quot;:&quot;center&quot;,&quot;vertialAlign&quot;:&quot;middle&quot;,&quot;fontSize&quot;:20,&quot;fontFamily&quot;:&quot;sans-serif&quot;,&quot;fontStyle&quot;:&quot;normal&quot;,&quot;fontWeight&quot;:&quot;normal&quot;},&quot;subtextStyle&quot;:{&quot;fontSize&quot;:12},&quot;show&quot;:true,&quot;left&quot;:&quot;center&quot;,&quot;top&quot;:&quot;top&quot;},&quot;toolbox&quot;:{&quot;feature&quot;:{&quot;magicType&quot;:{&quot;show&quot;:true,&quot;type&quot;:[&quot;line&quot;,&quot;bar&quot;,&quot;stack&quot;,&quot;tiled&quot;]},&quot;dataView&quot;:{&quot;show&quot;:true},&quot;restore&quot;:{&quot;show&quot;:true},&quot;saveAsImage&quot;:{&quot;show&quot;:true}},&quot;show&quot;:true,&quot;right&quot;:20},&quot;tooltip&quot;:{&quot;formatter&quot;:&quot;function (params) { var res = '';if (params.componentType &amp;&amp; params.componentType=='timeline'){return params.name;}if(params.length > 0){  var axis;if(params[0].axisType.indexOf('time') >= 0){if(params[0].axisDim == 'x'){axis = chartObject.getOption().xAxis[params[0].axisIndex];}else{axis = chartObject.getOption().yAxis[params[0].axisIndex];}}  if(axis &amp;&amp; axis.axisLabel &amp;&amp; axis.axisLabel.timePartten){res += new Date(params[0].name).format(axis.axisLabel.timePartten)+ '<br/>';}else{res += params[0].name + '<br/>';}for(var i = 0, l = params.length; i < l; i++){var param = params[i];if( param.value &amp;&amp; param.value.length){if(typeof param.value[0] == 'number'){res += param.seriesName+' : '+commafy(Number(param.value[0]).toFixed(2));}else if(typeof param.value[1] == 'number'){res += param.seriesName+' : '+commafy(Number(param.value[1]).toFixed(2));}else{res += param.seriesName+' : ';}}else{if(param.value){res += param.seriesName+' : '+param.value;}else{res += param.seriesName+' : ';}}if(param.percent != null){ res += '('+param.percent+'%)'; } res += '<br/>';} }else{if(params.seriesName){res += params.seriesName+'<br/>';}if(params.data.value.length > 0){if(typeof params.data.value[0] == 'number'){res += params.data.name+' : '+commafy(Number(params.data.value[0]).toFixed(2));}else if(typeof params.data.value[1] == 'number'){res += params.data.name+' : '+commafy(Number(params.data.value[1]).toFixed(2));}else{res += params.data.name+' : ';}}else{res += params.data.name+' : '+commafy(Number(params.data.value).toFixed(2));}} return res;  } &quot;,&quot;trigger&quot;:&quot;axis&quot;,&quot;show&quot;:true},&quot;legend&quot;:{&quot;data&quot;:[{&quot;name&quot;:&quot;急速快递&quot;}],&quot;orient&quot;:&quot;horizontal&quot;,&quot;show&quot;:false,&quot;left&quot;:&quot;center&quot;,&quot;top&quot;:&quot;bottom&quot;},&quot;xAxis&quot;:[{&quot;show&quot;:true,&quot;type&quot;:&quot;category&quot;,&quot;position&quot;:&quot;bottom&quot;,&quot;data&quot;:[{&quot;value&quot;:&quot;1&quot;},{&quot;value&quot;:&quot;2&quot;},{&quot;value&quot;:&quot;3&quot;},{&quot;value&quot;:&quot;4&quot;},{&quot;value&quot;:&quot;5&quot;},{&quot;value&quot;:&quot;6&quot;},{&quot;value&quot;:&quot;7&quot;},{&quot;value&quot;:&quot;8&quot;},{&quot;value&quot;:&quot;9&quot;}]}],&quot;yAxis&quot;:[{&quot;show&quot;:true,&quot;type&quot;:&quot;value&quot;,&quot;position&quot;:&quot;left&quot;}],&quot;series&quot;:[{&quot;name&quot;:&quot;急速快递&quot;,&quot;type&quot;:&quot;bar&quot;,&quot;xAxisIndex&quot;:0,&quot;yAxisIndex&quot;:0,&quot;data&quot;:[{&quot;name&quot;:&quot;1&quot;,&quot;value&quot;:[&quot;1&quot;,895.79]},{&quot;name&quot;:&quot;2&quot;,&quot;value&quot;:[&quot;2&quot;,935.90]},{&quot;name&quot;:&quot;3&quot;,&quot;value&quot;:[&quot;3&quot;,1488.74]},{&quot;name&quot;:&quot;4&quot;,&quot;value&quot;:[&quot;4&quot;,1407.23]},{&quot;name&quot;:&quot;5&quot;,&quot;value&quot;:[&quot;5&quot;,748.34]},{&quot;name&quot;:&quot;6&quot;,&quot;value&quot;:[&quot;6&quot;,546.13]},{&quot;name&quot;:&quot;7&quot;,&quot;value&quot;:[&quot;7&quot;,807.53]},{&quot;name&quot;:&quot;8&quot;,&quot;value&quot;:[&quot;8&quot;,785.25]},{&quot;name&quot;:&quot;9&quot;,&quot;value&quot;:[&quot;9&quot;,328.39]}]}],&quot;catalog&quot;:1,&quot;grid&quot;:{},&quot;drillLevel&quot;:0},&quot;cacheId&quot;:&quot;4&quot;,&quot;chartId&quot;:&quot;89f10245-19f3-4e16-bb30-b94a79bcef1c&quot;,&quot;tdId&quot;:&quot;S_1_D_A1&quot;,&quot;chartSQL&quot;:&quot;&quot;,&quot;msg&quot;:&quot;&quot;,&quot;chartCellName&quot;:&quot;[null!A1]图表&quot;,&quot;dataSourceType&quot;:1}\" _echarts_instance_=\"ec_1532762707654\"><div style=\"position: relative; overflow: hidden; width: 267px; height: 500px; padding: 0px; margin: 0px; border-width: 0px;\"><canvas style=\"position: absolute; left: 0px; top: 0px; width: 267px; height: 500px; -moz-user-select: none; padding: 0px; margin: 0px; border-width: 0px;\" width=\"267\" height=\"500\" data-zr-dom-id=\"zr_0\"></canvas></div><div></div></div></div><p></p><p></p><p style=\"text-align:start;\"><span style=\"line-height:34px;color:rgb(34, 34, 34);background-color:rgba(0, 0, 0, 0);font-family:微软雅黑, \" microsoft=\"\"><a href=\"javascript:void(0)\" class=\"we-link\" onclick=\"WR.linkClick.clickLinkedChart('lt7olsakx');return false;\" _href=\"javascript:void(0)\">图1</a>：折线图<br/><a href=\"javascript:void(0)\" class=\"we-link\" onclick=\"WR.linkClick.clickLinkedChart('pctmblk07');return false;\" _href=\"javascript:void(0)\">图2</a>：柱状图</span></p><p></p><p></p><p></p><p></p></div></body></html>\n";
        Html2PdfService html2PdfService = new Html2PdfService();//未引入spring，手动实例化
//        html2PdfService.excute("https://wkhtmltopdf.org");
        String filePath = strToHtmlFile(htmlContent);
        System.out.println(filePath);
        html2PdfService.excute(filePath);
    }

    /**
     * 将HTML字符串转换为HTML文件
     *
     * @param htmlStr HTML字符串
     * @return HTML文件的绝对路径
     */
    public static String strToHtmlFile(String htmlStr) {
        OutputStream outputStream = null;
        try {
            String htmlFilePath = TEMP_DIR_PATH + UUID.randomUUID().toString() + ".html";
            outputStream = new FileOutputStream(htmlFilePath);
            outputStream.write(htmlStr.getBytes("UTF-8"));
            return htmlFilePath;
        } catch (Exception e) {
            throw new RuntimeException(e);
        } finally {
            try {
                if (outputStream != null) {
                    outputStream.close();
                    outputStream = null;
                }
            } catch (Exception e) {
                throw new RuntimeException(e);
            }
        }
    }
}
